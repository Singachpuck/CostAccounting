# Cost Accounting (v3)

## This application provides REST API to keep track of your expenses

## Release notes:
- **Add Account entity (Variant 3)**
- Update version of api to ```v3```
- Add jwt authentication for all endpoints
- Add authorization logic (users can create Account only for themselves, transactions can only be made only from authenticated account etc.)
- Validation improvements
- Error handling
- Add .gitignore


### Available endpoints:

- Add category
    - Url:  
      ```/api/v3/categories```
    - Method:  
      ```POST```
    - Payload:
      ```json
      {
          "name": "string"
      }
      ```
- Get categories
    - Url:  
      ```/api/v3/categories```
    - Method:  
      ```GET```
- Add user
    - Url:  
      ```/api/v3/users```
    - Method:  
      ```POST```
    - Payload:
      ```json
      {
          "name": "string",
          "password": "string"
      }
      ```
- Login
    - Operation tries to log in into the system with existing credentials and 
  returns access_token if success
    - Url:  
      ```/api/v3/login```
    - Method:  
      ```POST```
    - Payload:
      ```json
      {
          "name": "string",
          "password": "string"
      }
      ```
    - Response:
      ```json
      {
          "access_token": "string",
          "expires_in": "int"
      }
      ```
- Add account
  - Url:  
    ```/api/v3/accounts```
  - Method:  
    ```POST```
  - Payload:
    ```json
    {
        "name": "int",
        "amount": "decimal"
    }
    ```
- Get accounts
  - Url:  
    ```/api/v3/accounts```
  - Method:  
    ```GET```
- Add transaction between specific accounts
    - Url:  
      ```/api/v3/transactions```
    - Method:  
      ```POST```
    - Payload:
      ```json
      {
           "account_from": "int",
           "account_to": "int",
           "amount": "decimal",
           "category": "int"
      }
      ```
- Get transactions for user with category
    - Url:  
      ```/api/v3/users/<userId>/transactions?category=<category name>```
    - Method:  
      ```GET```
    - Query parameter is optional
    - Returns list of transactions where user is owner of Account where the money was taken from (accountFrom)

### To run locally:

- Clone this repository
- Make sure you have flask installed: ```flask --version```
- Set environmental variable with the name ```JWT_SECRET_KEY``` with the secret value for jwt.
This can be generated by executing the following code in python console:
    ```python
    import secrets
    secrets.SystemRandom().getrandbits(128)
    ```
- Set environmental variable with the name ```DATABASE_URI``` with the value that contains database connection string for ```sqlite3```.  
  Example of connection string:  ```sqlite:///D:\path\to\database\database.db```  
  For testing purposes you can use project database under the path ```../db/database.db```
- In the repository root run:
  - ```flask --app rest run```

## Deployment details
- The application has been deployed to the https://render.com/ manually.  
- The service automatically deploys an application every time the commit to main branch is made. 
- You can access this application by the following path: https://cost-accounting.onrender.com